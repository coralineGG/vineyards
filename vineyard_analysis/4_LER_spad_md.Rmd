---
title: "4_LER_spad"
author: "Lucile regouby"
date: "21/11/2022"
output:
  html_document:
    df_print: paged
  pdf_document: default
  word_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Contexte sur l'analyse 

We want to answer to this theme of our project weed regulation and competition in the cover, Assing this question : Which species work better in association as a cover crop? 

## Importation of data an libraries

### Libraires importation

```{r cars}
library(tidyverse)
library(ggplot2)
library(agricolae)
```

### data importation 

```{r}
LER.1= read.table("4_LER.csv", header = TRUE,sep = ";", dec = ",")

LER<- LER.1%>%
  mutate(Line = as.factor(Line))
```


## 1.  -- LER Analysis -- The mixed cover will be more productive in biomass than the monoculture cover.

### Complete LER analysis between all the treatments 

graph of the values of LER in function of the treatment
```{r}
LER %>%
  filter( mono_mix == "mix") %>%
  filter (Specie != "Weed") %>%
  group_by(Line)%>%
  summarise(mymean=mean(LER_cc, na.rm=T),
            mysd=sd(LER_cc, na.rm=T))%>%
  mutate(ymax=mymean+mysd, ymin=mymean-mysd) %>%
  ggplot (aes(x = reorder(Line, mymean), y = mymean,
              ymin=ymin, ymax=ymax, na.rm=T)) + 
  geom_point()+
  geom_errorbar()+
  labs(x="Number of the treatment", y="LER value", title = "LER value in function of the treatment")

```
choisir celui là parce que le boxplot on ne voit pas bien les petits points 


Graph en boxplot 

```{r}
view(LER)

LER %>%
  filter( mono_mix == "mix")%>%
  filter (Specie != "Weed") %>%
  group_by(Line)%>%
  #summarise(mymean=mean(LER_cc, na.rm=T))%>%
  ggplot ()+
  aes(x = Line, y=LER_cc, fill=Line)+
  geom_boxplot()+
  labs(x="Number of treatment", y="LER value", title = "LER value in function of the treatment")
  
```
n'arrive pas à reorder, il faudrait enlever des valeurs parce que qu'elles ne permettent pas de bien voir la répartition des autres

vérification des hypothèses de l'anova :

```{r}
shapiro.test(LER$LER_cc)

```
shapiro test pvalue<0,05 ==> no normality of LER_cc

kruskal wallis test 
```{r}
kruskal.LER.cc <- kruskal(LER$LER_cc, LER$Line,  console = T)
```
no significantive difference 


### Analysis of the LERp for each specie between mix and monoculture -- NOT USEFUL AS SAID AURELIE

#### Radish 

graphique du LERp entre tous les différents treatments où il y a du radis (mono ou mix)
```{r}
LER%>%
  filter( Specie == "Radish") %>%
  group_by(Line)%>%
  summarise(mymean=mean(LERp, na.rm=T),
            mysd=sd(LERp, na.rm=T))%>%
  mutate(ymax=mymean+mysd, ymin=mymean-mysd) %>%
  ggplot (aes(x = reorder(Line, mymean), y = mymean,
              ymin=ymin, ymax=ymax, na.rm=T)) + 
  geom_point()+
  geom_errorbar()+
  labs(x="Line", y="LERp value", title = "LERp value in function of the radish treatment (monoculture or mix)")
```
commentaire : la ligne 13 c'est un mélange avec le radis qui n'a pas marché du tout
la ligne 7 c'est le radis en monoculture ==> normal qu'il n'y ai pas de variation ==> LERp=1

graph avec un boxplt :
```{r}
LER %>%
  filter( Specie == "Radish") %>%
  group_by(Line)%>%
  ggplot ()+
  aes(x=Line, y=LERp, fill=Line)+
  geom_boxplot()+
  labs(x="Line", y="LERp value", title = "LERp value in function of the radish treatment (monoculture or mix)")
```

test avec une anova :
```{r}
LER.radish <- LER%>%
  filter( Specie == "Radish")
anova.LER.radish <-lm(LERp~Line+zone,LER.radish)
anova(anova.LER.radish)
summary(anova.LER.radish)
```
pas de différence significative entre les treatments

vérifier les hypothèses de l'anova :

```{r}
par(mfrow = c(2,2))
plot(anova.LER.radish)
```
Pas ouff; la normalité est pas du tout respecté, on a vraiment très peu de valeurs pour le coup 

test d'un kruskal
```{r}
kruskal.radish <- kruskal(LER.radish$LERp, LER.radish$Line, console = T)
```

ils ne sont pas significativement différents


#### Barley 

graphique du LERp de tous les treatment où il y a du barley (mono ou mix)

```{r}
LER%>%
  filter( Specie == "Barley") %>%
  group_by(Line)%>%
  summarise(mymean=mean(LERp, na.rm=T),
            mysd=sd(LERp, na.rm=T))%>%
  mutate(ymax=mymean+mysd, ymin=mymean-mysd) %>%
  ggplot (aes(x = reorder(Line, mymean), y = mymean,
              ymin=ymin, ymax=ymax, na.rm=T)) + 
  geom_point()+
  geom_errorbar()+
  labs(x="Line", y="LERp value", title = "LERp value in function of the barley treatment (monoculture or mix)")
```
On peut quand même voir que la plus part des treatments ils sont en dessous de 1 / du controle en ligne 6 

graph avec les boxplot
```{r}
LER %>%
  filter( Specie == "Barley") %>%
  group_by(Line)%>%
  ggplot ()+
  aes(x=Line, y=LERp, fill=Line)+
  geom_boxplot()+
  labs(x="Line", y="LERp value", title = "LERp value in function of the barley treatment (monoculture or mix)")
```



anova :
```{r}
LER.B <- LER%>%
  filter( Specie == "Barley")

anova.LER.B <-lm(LERp~Line,LER.B)
anova(anova.LER.B)
summary(anova.LER.B)
```
pas de différence significative entre les treatments

vérification des hypothèses de l'anova :

```{r}
par(mfrow = c(2,2))
plot(anova.LER.B)
```
La normalité est pas ouf, le reste ça passe

test d'un kruskal, j'ai pas le droit mais j'en fait un quand même:

```{r}
kruskal.B <- kruskal(LER.B$LERp, LER.B$Line, console = T)
```
Les lignes 4 et 13 c'est des mix de 3 espèces ==> pour celà qu'ils sont différents. La ligne 6 c'est le barley en monoculture 

meilleur graphique : 

```{r eval=FALSE, include=FALSE}
posthock.B <- kruskal.B$groups %>%
  rownames_to_column("Line") %>%
  mutate(Line = as.factor(Line)) %>%
  select(Line, groups)

LER%>%
  filter( Specie == "Barley") %>%
  group_by(Line)%>%
  summarise(mymean=mean(LERp, na.rm=T),
            mysd=sd(LERp, na.rm=T))%>%
  mutate(ymax=mymean+mysd, ymin=mymean-mysd) %>%
  full_join(posthock.B) %>%
  ggplot (aes(x = reorder(Line, mymean), y = mymean, label = groups,
              ymin=ymin, ymax=ymax, na.rm=T)) + 
  geom_point()+
  geom_text(aes(y=2,5))+
  geom_errorbar()+
  labs(x="Line", y="LERp value", title = "LERp value in function of the barley treatment (monoculture or mix)")

## problème dans l'affichage des lettres ==> je ne sait pas comment y remédier 
```

```{r}
LER %>%
  filter( Specie == "Barley") %>%
  group_by(Line)%>%
  full_join(posthock.B) %>%
  ggplot ()+
  aes(x=Line, y=LERp, fill=Line, label = groups)+
  geom_boxplot()+
  geom_text(aes(y=2,5))+
  labs(x="Line", y="LERp value", title = "LERp value in function of the barley treatment (monoculture or mix)")
```


#### Mustard

```{r}
LER%>%
  filter( Specie == "Mustard") %>%
  group_by(Line)%>%
  summarise(mymean=mean(LERp, na.rm=T),
            mysd=sd(LERp, na.rm=T))%>%
  mutate(ymax=mymean+mysd, ymin=mymean-mysd, ) %>%
  ggplot (aes(x = reorder(Line, mymean), y = mymean,
              ymin=ymin, ymax=ymax, na.rm=T)) + 
  geom_point()+
  geom_errorbar()+
  labs(x="Line", y="LERp value for mustard", title = "LERp value in function of the mustard treatment (monoculture or mix)")
```
La ligne 14 c'est la moutarde en monoculture 
La ligne 4 : qu'une seule valeur pour une zone est valables 

graph en boxplot:
```{r}
LER %>%
  filter( Specie == "Mustard") %>%
  group_by(Line)%>%
  ggplot ()+
  aes(x=Line, y=LERp, fill=Line)+
  geom_boxplot()+
  labs(x="Line", y="LERp value", title = "LERp value in function of the mustard treatment (monoculture or mix)")
```
on a vraiment des valeurs beaucoup trop hautes et ça ne nous permet pas de voir les differences entre les lignes 4 et 14

anova:
```{r}
LER.m <- LER%>%
  filter( Specie == "Mustard")

anova.LER.m <-lm(LERp~Line,LER.m)
anova(anova.LER.m)
summary(anova.LER.m)
```
pas de différence significative 
vérification des hypothèses 

```{r}
par(mfrow = c(2,2))
plot(anova.LER.m)
```
encore une fois on a vraiment très peu de valeurs dont 2 valeurs qui sont pas ouf (la 2 et la 8)

test sans ces 2 valeurs : ==> en vrai flemme de ouf 

#### Faba bean 
```{r}
LER%>%
  filter( Specie == "Faba bean") %>%
  group_by(Line)%>%
  summarise(mymean=mean(LERp, na.rm=T),
            mysd=sd(LERp, na.rm=T))%>%
  mutate(ymax=mymean+mysd, ymin=mymean-mysd, ) %>%
  ggplot (aes(x = reorder(Line, mymean), y = mymean,
              ymin=ymin, ymax=ymax, na.rm=T)) + 
  geom_point()+
  geom_errorbar()+
  labs(x="Line", y="LERp value for faba bean", title = "LERp value in function of the faba bean treatment (monoculture or mix)")
```
Line 4 : mix of 3
Line 11: Faba bean in monoculture 

graph with boxplot 

```{r}
LER %>%
  filter( Specie == "Faba bean") %>%
  group_by(Line)%>%
  ggplot ()+
  aes(x=Line, y=LERp, fill=Line)+
  geom_boxplot()+
  labs(x="Line", y="LERp value", title = "LERp value in function of the faba bean treatment (monoculture or mix)")
```


```{r}
LER.fb <- LER%>%
  filter( Specie == "Faba bean")

anova.LER.fb <-lm(LERp~Line,LER.fb)
anova(anova.LER.fb)
summary(anova.LER.fb)
```

pas de différence significatif 

```{r}
par(mfrow = c(2,2))
plot(anova.LER.fb)
```

Pas ouf mais de toute façon pas énormément de valeurs 


#### Fenugreek 

```{r}
LER%>%
  filter( Specie == "Fenugreek") %>%
  group_by(Line)%>%
  summarise(mymean=mean(LERp, na.rm=T),
            mysd=sd(LERp, na.rm=T))%>%
  mutate(ymax=mymean+mysd, ymin=mymean-mysd, ) %>%
  ggplot (aes(x = reorder(Line, mymean), y = mymean,
              ymin=ymin, ymax=ymax, na.rm=T)) + 
  geom_point()+
  geom_errorbar()+
  labs(x="Line", y="LERp value for fenugreek", title = "LERp value in function of the fenugreek treatment (monoculture or mix)")

```
Line 8: monoculture
Line 3: mix of 2 
Line 13: mix of 3

boxplot:
```{r}
LER %>%
  filter( Specie == "Fenugreek") %>%
  group_by(Line)%>%
  ggplot ()+
  aes(x=Line, y=LERp, fill=Line)+
  geom_boxplot()+
  labs(x="Line", y="LERp value", title = "LERp value in function of the fenugreek treatment (monoculture or mix)")
```


```{r}
LER.fn <- LER%>%
  filter( Specie == "Fenugreek")

anova.LER.fn <-lm(LERp~Line,LER.fn)
anova(anova.LER.fn)
summary(anova.LER.fb)
```
pas de différence significative 

```{r}
par(mfrow = c(2,2))
plot(anova.LER.fn)
```
pas ouf 


## Spad analysis ##############

### importation of the data and pivot : 
```{r}
spad = read.table("4_bis_spad.csv", header = TRUE,sep = ",", dec = ".")

spad%>%
  mutate(Line = as.factor(Line), nature=as.factor(nature),
         legumes=as.factor(legumes), Date=as.factor(Date)) -> spad

```

### spad analysis for both dates

#### For all the treatments and all the dates 

verification that we can use anova 
```{r}
shapiro.test(spad$spad_value)
```
pvalue < 0,05 ==> not normality of the values ==> can't use anova 

test de kruskal:

```{r}
kruskal.spad.all <- kruskal(spad$spad_value, spad$Line, console = T)
```

graph with the letters of the kruskal

```{r}
posthock.spad.all <- kruskal.spad.all$groups %>% 
  rownames_to_column("Line") %>% 
  select(Line, groups)%>%
  mutate(Line= as.factor(Line))

spad%>%
  group_by(Line)%>%
  full_join(posthock.spad.all)%>%
  ggplot () +
  aes(x = Line, y = spad_value, label = groups, fill=Line)+
  geom_text(aes(y=0))+
  geom_boxplot()+
  labs(x="Number of the treatment", y="Spad value", title = "Spad value in function of the treatment")
```

Il est possible de faire la même chose pour les espèces séparément entre les monoculture et les mixes 
#### For barley 
#### For mustard
#### Radish
#### For Faba bean
#### Fenugreek


### spad analysis for the first date - NOT interesting as we have it for all the dates 

#### For all the treatments 
```{r}
spad.1 <- spad%>%
  filter( Date == "17/10")
```


test anova

```{r}
anova.spad.all.1 <-lm(spad_value~Line+zone,spad.1)
anova(anova.spad.all.1)
summary(anova.spad.all.1)
```
anova significative !!!!

vérification des hypothèses de l'anova: 

```{r}
par(mfrow = c(2,2))
plot(anova.spad.all)
```
hypothèse de normalité pas incroyable ==> est ce qu'on peut vraiment faire une anova?

test de kruskal:

```{r}
kruskal.spad.all <- kruskal(spad.1$spad_value, spad.1$Line, console = T)
```

graph with the letters of the kruskal

```{r}
posthock.spad.all <- kruskal.spad.all$groups %>% 
  rownames_to_column("Line") %>% 
  select(Line, groups)%>%
  mutate(Line= as.integer(Line))
spad.1%>%
  group_by(Line)%>%
  summarise(mymean=mean(spad_value, na.rm=T),
            mysd=sd(spad_value, na.rm=T))%>%
  mutate(ymax=mymean+mysd, ymin=mymean-mysd) %>%
  full_join(posthock.spad.all)%>%
  ggplot (aes(x = reorder(Line, mymean), y = mymean, label = groups, 
              ymin=ymin, ymax=ymax, na.rm=T)) + 
  geom_point()+
  geom_text(aes(y=85))+
  geom_errorbar()+
  labs(x="Line", y="spad value", title = "Sapad value in function of the treatment")
```

tukey because anova is great ??

```{r}
# tukey.spad.all.1 <- HSD.test(spad.1, "Line", alpha=0.05, group=TRUE, main = NULL, console = FALSE)
# print(tukey.spad.all.1)
# posthock.spad.all.2 <- tukey.spad.all.1%>%
#   rownames_to_column("Line")%>%
#   select(Line, groups)
# 
# view(posthock.spad.all.2)



### Spad analysis for the second date -- j'ai mis les deux dates dans la première analyse 
je ne vait pas le faire c'est juste un copier coller 

```{r}
spad.2 <- spad%>%
  filter( Date == "07/11")

```


test anova

```{r}
anova.spad.all.2 <-lm(spad_value~Line,spad.2)
anova(anova.spad.all.2)
```
anova significative 

vérification des hypothèses :

```{r}
par(mfrow = c(2,2))
plot(anova.spad.all)
```
la normalité est pas dingue 

test de kruskal:
```{r}
kruskal.spad.all.2 <- kruskal(spad.2$spad_value, spad.2$Line, console = T)

```

graph with letters of the kruskal

```{r}
posthock.spad.all.2 <- kruskal.spad.all.2$groups %>% 
  rownames_to_column("Line") %>% 
  select(Line, groups)%>%
  mutate(Line= as.integer(Line))

spad.2%>%
  group_by(Line)%>%
  summarise(mymean=mean(spad_value, na.rm=T),
            mysd=sd(spad_value, na.rm=T))%>%
  mutate(ymax=mymean+mysd, ymin=mymean-mysd) %>%
  full_join(posthock.spad.all.2)%>%
  ggplot (aes(x = reorder(Line, mymean), y = mymean, label = groups, 
              ymin=ymin, ymax=ymax, na.rm=T)) + 
  geom_point()+
  geom_text(aes(y=65))+
  geom_errorbar()+
  labs(x="Line", y="spad value", title = "Sapad value of 07/11 in function of the treatment")
```




### Spad analysis of the impact of the legume and the mix or monoculture effect
```{r}
spad%>%
  group_by(Line)%>%
  ggplot (aes(x = nature, y = legumes, na.rm=T)) + 
  geom_jitter()+
  labs(x="Nature of the treatment", y="Presence of legume in the treatment", title = "Distributions of spad values between the nature of the treatment and the presence or not of legumes in the treatment")
```
same repartition between mix and monoculture and with or without legumes in the treatment ==> I don't know how to analyse it 

test statistique 

```{r}
anova.spad.legumes.mix <-lm(spad$spad_value~spad$nature+spad$legumes+spad$nature*spad$legumes, spad)
anova(anova.spad.legumes.mix)
```

The spad values are mostly explained by the interaction between the nature of the cover and the presence of legumes.



```{r pressure, echo=FALSE}

```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
